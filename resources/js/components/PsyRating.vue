<template>
    <div class="container">
            <div class="page-content">
                <div class="row justify-content-center">
                    <div class="col-md-12 col-sm-12">
                        <div class="x_panel">
                            <div class="x_title" style="background:lightgrey;padding:7px; border-radius:3px; margin-top:5px;">
                                <h1><strong>BRIEF PSYCHIATRIC RATING SCALE BPRS</strong></h1>
                            </div>
                            <div class="x_content">
    
                                <!-- <div class="tab-content" id="myTabContent"> -->
                                <form id="demo-form2" data-parsley-validate class="form-horizontal form-label-left align-items-center">
    
                                    <table>
                                        <tr>
                                            <th>Descrizioni</th>
                                        </tr>
                                        <tr>
                                        <div class="row" style="margin-top:20px;">
                                            <div class="col-md-12 col-sm-12">
                                                <div class="item form-group">
                                                    <label for="marital_status" class="col-form-label col-md-6 col-sm-2 label-align">1. Stato civile</label>
                                                    <span class="col-md-12 col-sm-12">
                                                        <td>Preoccupazioni somatiche</td>
                                                        <tr>
                                                            <td>
                                                                NV
                                                            </td>
                                                            <td>1</td>
                                                            <td>2</td>
                                                            <td>3</td>
                                                            <td>4</td>
                                                            <td>5</td>
                                                            <td>6</td>
                                                            <td>7</td>
                                                        </tr>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <td>Preoccupazioni somatiche</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Ansia</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Depressione</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Rischio di suicidio</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Sentimenti di colpa</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Ostilità</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Elevazione del tono dell'umore</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Grandiosità</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Sospettosità</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Allucinazioni</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Contenuto insolito del pensiero</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                        <td>Comportamento bizzarro</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Trascuratezza della cura di sé</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Disorientamento</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                    </table>

                                    <div>
                                        <h2>
                                            Valutare i seguenti item da 15 a 24 in base all'eloquio del paziente a al suo comportamento                 durante l'intervista 
                                        </h2>
                                    </div>
                                    
                                    <table>
                                        <tr>
                                            <td>Disorganizzazione Concettuale</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Appiattimento affettivo</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Isolamento emotivo</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Rallentamento motorio</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Tensione motoria</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Mancanza di cooperazione</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Eccitamento</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Distraibilità</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Iperattività motoria</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                        <tr>
                                            <td>Manierismi e posture</td>
                                            <td>NV</td>
                                            <td>1</td>
                                            <td>2</td>
                                            <td>3</td>
                                            <td>4</td>
                                            <td>5</td>
                                            <td>6</td>
                                            <td>7</td>
                                        </tr>
                                    </table>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
</template>




<style lang="scss" scoped>

.labelWidth {
min-width: 190px;
}
.dbTitle {
background: #184140;
color: white;
padding: 10px;
font-weight: bold !important;
}
.item input, .item textarea {
margin-right: 10px;
}
.treatment{
border:1px double #f1f1f1;
margin: 1.5rem 0;
padding: 20px 15px;
font-style: italic; 
-webkit-box-shadow: 1px 1px 3px 1px #ccc; 
box-shadow: 1px 1px 3px 1px #ccc; 
border-radius: 5px;
color: #333; 
}

</style>



<script>
   
import * as actions from "../config/ApiUrl";
import axios from 'axios';
import Swal from 'sweetalert2';

export default {
    name: 'psyRating',

    data() {
        return {
            userName: 'Andrea',
            userLastName:'Giovanni',
            userFullName:'',
            userInstance:1,
            userId:0,

            selectedOption: null,
            sum: 0,

            accessData:[
               
                id => 14,
                name => 'Alessio',
                lastname => 'Ortu',
                
            ],
            psyPrDoctorId:0,
            psyPrDoctorName:'',
            psyPrDoctorLastname:'',
            psyPrDate:null,
            psyCardId:null,
            date:new Date(),

            psyCardPr:{},


            panel:'pr',

            psyCardMh:{},


            mainTitle:"psy",
            firstSave:true,
            pRSaved:false,

            
            btnPrSend:"Salva",
            total:0,               
            allPsyRatings:null,
        }
    },

    created: function () {
        // this.getPermissions();
        this.getPsyRatingsByUserInstanceId(1);
    },


    methods: {
        calculateSum() {
            // Calcola la somma delle opzioni selezionate
            //this.sum = parseInt(this.selectedOption) || 0;
            let i=0;
            for (const property in this.psyCardPr) {
                i += parseInt(this.psyCardPr[property]);  
            }
            console.log(i);
            this.sum=i;
        },

        
        addPsyRating(panel){
            let _wm = this;
            let _panel=panel;
            let _errors=0;
            let _errorTitle="Scheda"
            let _errorDescription="Non aggiornata";
            let form = new FormData();
            form.append('userName', this.userName);
            form.append('userLastName', this.userLastName);
            form.append('userFullName', this.userFullName);
            form.append('userInstance', this.userInstance);
            form.append('userId', this.userId);
            // form.append('doctorId', this.accessData.id);
            // form.append('doctorName', this.accessData.name);
            // form.append('doctorUserName', this.accessData.lastname);
            form.append('doctorId', 14);
            form.append('doctorName', 'mario');
            form.append('doctorUserName', 'bross');
            
            if(_panel=='pr'){

                if(!this.pRSaved){
                    form.append('action', 'store');
                }else{
                    form.append('action', 'update');
                    if(this.psyCardId){
                        form.append('psyId',this.psyCardId);
                    }else{
                        _errors++;
                        _errorTitle="Attenzione";
                        _errorDescription="Dati mancanti o incompleti contattare l\'amministratore di sistema"
                    }
                }
                form.append('section', 'pr');
                if(!this.isObjEmpty(this.psyCardMh)){
                    let _psyCardMh=JSON.stringify(this.psyCardMh);
                    alert(JSON.stringify(this.psyCardMh))
                    form.append('psyCardMh', _psyCardMh);
                }
                if(!this.isObjEmpty(this.psyCardPr)){
                    let _psyCard=JSON.stringify(this.psyCardPr);
                    form.append('psyCard', _psyCard);
                }
            }else if(_panel=='mh'){

                if(!this.mHSaved){
                    form.append('action', 'store');
                }else{
                    form.append('action', 'update');
                }
                if (this.mHSaved) {
                    if(this.psyCardId){
                        form.append('psyId',this.psyCardId);
                    }else{
                        _errors++;
                        _errorTitle="Attenzione";
                        _errorDescription="Dati mancanti o incompleti contattare l\'amministratore di sistema"
                    }
                    form.append('section', 'mh');
                    if(!this.isObjEmpty(this.psyCardMh)){
                        let _psyCardMh=JSON.stringify(this.psyCardMh);
                        form.append('psyMentalHealthDepartment', _psyCardMh);
                    }  
                }
            }

            if(_errors==0){
                try {
                    axios.post(actions.ADD_PSY_CARD,form).then(response => {
                        let error=response.data.errorNumber;
                        let _attempts=response.data.attempts;
                        _wm.errNum=error;
                        if(error == 0){

                            Swal.fire(
                                'Scheda',
                                'Aggiornata correttamente',
                                'success'
                            )
                            this.getPsyRatingsByUserInstanceId(this.userInstance);
                        }else{
                            // eventBus.$emit('errorEvent', error, _attempts);
                            Swal.fire(
                                'Scheda',
                                'Non aggiornata contattare l\'amministratore di sistema',
                                'warning'
                            )
                        }
                    });
                } catch (error) {
                    throw error
                }
            }else{
                Swal.fire(
                    _errorTitle,
                    _errorDescription,
                    'error'
                )
            }
        },    


        getPsyRatings(){
            //GET ALL CARDS
            let _wm = this;
            try {
                axios.get(actions.GET_PSY_CARDS).then(response => {
                    let error=response.data.errorNumber;
                    let _attempts=response.data.attempts;
                    _wm.errNum=error;
                    if(error == 0){
                        //alert(JSON.stringify(response))
                    }else{
                        // eventBus.$emit('errorEvent', error, _attempts);
                    }
                });
            } catch (error) {
                throw error
            }
        },
        getPsyRatingById(id){
            let _wm = this;
            try {
                let url=actions.GET_PSY_CARD_BY_ID+'/'+id;
                axios.get(url).then(response => {
                    let error=response.data.errorNumber;
                    let _attempts=response.data.attempts;
                    _wm.errNum=error;
                    if(error == 0){
                        //alert(JSON.stringify(response))
                    }else{
                        // eventBus.$emit('errorEvent', error, _attempts);
                    }
                });
            } catch (error) {
                throw error
            }
        },
        getPsyRatingsByUserInstanceId(id){
            let _wm = this;
            // alert('yy');

            try {
                let url=actions.GET_PSY_CARDS_BY_USER_INSTANCE_ID+'/'+id;
                axios.get(url).then(response => {
                    let error=response.data.errorNumber;
                    // let _attempts=response.data.attempts;
                    _wm.errNum=error;
                    //alert(JSON.stringify(response.data));
                    if(error == 0){
                      
                        _wm.mainTitle="Aggiornamento Cartella psy";
                        if(response.data.PsyRating){
                            _wm.pRSaved=true;
                            _wm.btnPrSend="Aggiorna";

                            let _PsychiatricScal=response.data.PsySuicideAssessment;
                            // _wm.psyCardId=response.data.psyCard.id;
    
                            _wm.psyCardId=response.data.psyCard.id;
                            _wm.psyPrDoctorId = _PsychiatricScal.id_doctor;

                            _wm.psyPrDoctorName = _PsychiatricScal.doctor_name;
                            _wm.psyPrDoctorLastname = _PsychiatricScal.doctor_lastname;

                            
                            _wm.psyCardPr.somaticConcern =_PsychiatricScal.somatic_concern;
                            _wm.psyCardPr.anxiety = _PsychiatricScal.anxiety 	
                            _wm.psyCardPr.depression = _PsychiatricScal.depression 
                            _wm.psyCardPr.riskOfSuicide = _PsychiatricScal.risk_of_suicide
                            _wm.psyCardPr.feelingOfGuilt = _PsychiatricScal.feeling_of_guilt 
                            _wm.psyCardPr.hostility = _PsychiatricScal.hostility
                            _wm.psyCardPr.moodElevation = _PsychiatricScal.mood_elevation
                            _wm.psyCardPr.grandeur = _PsychiatricScal.grandeur 
                            _wm.psyCardPr.suspiciousness = _PsychiatricScal.suspiciousness
                            _wm.psyCardPr.hallucination = _PsychiatricScal.hallucination 
                            _wm.psyCardPr.unusualContentOfThought = _PsychiatricScal.unusual_content_of_thought
                            _wm.psyCardPr.bizarreBehavior = _PsychiatricScal.bizarre_behavior 
                            _wm.psyCardPr.neglectOfSelfCare = _PsychiatricScal.neglect_of_self_care
                            _wm.psyCardPr.disorientation = _PsychiatricScal.disorientation
                            _wm.psyCardPr.conceptualDisorganization = _PsychiatricScal.conceptual_disorganization
                            _wm.psyCardPr.emotionalFlattening = _PsychiatricScal.emotional_flattening 
                            _wm.psyCardPr.emotionalIsolation = _PsychiatricScal.emotional_isolation 
                            _wm.psyCardPr.motorSlowdown = _PsychiatricScal.motor_slowdown 
                            _wm.psyCardPr.lackOfCooperation = _PsychiatricScal.lack_of_cooperation
                            _wm.psyCardPr.excitement = _PsychiatricScal.excitement
                            _wm.psyCardPr.distractibility = _PsychiatricScal.distractibility
                            _wm.psyCardPr.motorHyperactivity = _PsychiatricScal.motor_hyperactivity
                            _wm.psyCardPr.mannerismAndPosture = _PsychiatricScal.mannerism_and_posture
                            _wm.psyCardPr.totalScotrRating = _PsychiatricScal.total_score_rating



                            _wm.allPsyRatings=response.data.allPsyRatings;
                        }else{
                            _wm.btnPrSend="Salva";
                        }
                        
                        _wm.firstSave=false;
                    }else if(error == 7){
                        _wm.btnPrSend="Salva";
                        _wm.firstSave=true;
                    }
                    else{
                        // eventBus.$emit('errorEvent', error, _attempts);
                    }
                });
            } catch (error) {
                throw error
            }
        },
        isObjEmpty (obj) {
            return Object.keys(obj).length === 0;
        },



    }
}   
</script>
